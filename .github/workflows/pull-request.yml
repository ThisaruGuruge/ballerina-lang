name: Pull Request Build

on: pull_request

jobs:
    ubuntu-build:
        name: Build on Ubuntu
        runs-on: ubuntu-18.04
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v2

            - name: Setup JDK
              uses: actions/setup-java@v2
              with:
                distribution: 'adopt'
                java-version: 8

            - name: Setup Node
              uses: actions/setup-node@v2
              with:
                  node-version: '5.6.0'

            - name: NPM Install
              run: |
                  cd tool-plugins/vscode
                  npm install --unsafe-perm
                  npm run vscode:prepublish
                  cd ..

            - name: Build Ballerina Lang
              run: |
                  git submodule init
                  git submodule update
                  ./gradlew build -x createJavadoc --stacktrace -scan --console=plain --no-daemon

    windows-build:
        name: Build on Windows
        runs-on: windows-latest
        steps:
            - name: Checkout Repository
              uses: actions/checkout@v2

            - name: Setup JDK
              uses: actions/setup-java@v2
              with:
                  distribution: 'adopt'
                  java-version: 8

            - name: Setup Node
              uses: actions/setup-node@v2
              with:
                  node-version: '5.6.0'

            - name: NPM Install
              run: npm install

            - name: Build Ballerina Lang
              run: |
                  git submodule init
                  git submodule update
                  ./gradlew.bat build -x createJavadoc --stacktrace -scan --console=plain --no-daemon
